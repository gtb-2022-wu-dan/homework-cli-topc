#!/usr/bin/env bash

HISTORY_FILE="${1:?history file is required!}"

sed -E 's/ +\| +/\n/g' "${HISTORY_FILE}" \
    | sed -E \
        -e 's/^ +//' \
        -e 's#^./scripts/##' \
        -e 's/^sudo +//' \
        -e 's/^nohup +//' \
    | cut -d' ' -f1 \
    | grep -v -E '^(cd|ls|ll|echo|cat|vim)$' \
    | awk '{cmds[$1]++; total++;} END{for (cmd in cmds) {printf "%d %.2f%% %s\n", cmds[cmd], cmds[cmd]/total*100, cmd;}}' \
    | sort -t' ' -k1,1nr -k3,3 \
    | head -n10 \
    | awk '{printf "%4d %6s  %s\n", $1, $2, $3}'
    # | sort \
    # | uniq -c \
    # | sort -n

